<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>SkyScope</title>
    <link rel="stylesheet" href="/bootstrap-5.3.5-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/globalStyle.css">
    <script src="/bootstrap-5.3.5-dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<main class="container d-flex justify-content-center align-items-center">
    <div class="card card-main h-100 rounded-5 shadow-lg border-0">
        <div class="card-body">
            <div class="card-title container text-center">
                <div class="row align-items-center">
                    <h5 class="card-name col"
                        th:text="${offer.getItineraries().getFirst().getSegments().getFirst().getDeparture().getAirportName()}"></h5>
                    <h5 class="card-title col" name="durationAndTransfers"
                        th:text="${offer.getItineraries().getFirst().getDuration() + offer.getItineraries().getFirst().getTransferNumber()}"></h5>
                    <h5 class="card-name col"
                        th:text="${offer.getItineraries().getFirst().getSegments().getLast().getArrival().getAirportName()}"></h5>
                </div>
            </div>
            <p class="card-text fs-5">Ár: <span name="price" class="fw-bold text-success"
                                                th:text="${offer.price.total}"></span> HUF</p>
        </div>
        <div class="card-footer border-0 d-flex flex-wrap gap-2 justify-content-between">
            <form method="post" th:action="@{'/createOrder/payment/' + ${searchId}}">
                <button class="btn btn-primary" type="submit" id="payBtn">Fizetés</button>
            </form>
        </div>
        <div th:attr="id=${offer.getId()}">
            <div class="card card-secondary h-100 mb-3 shadow-sm border-0">
                <div class="card-body">
                    <div class="card-text container text-center"
                         th:each="itinerary, itineraryStatus : ${offer.getItineraries()}">
                        <div class="row text-start">
                            <h5 th:text="${itineraryStatus.odd ? 'Induló járat' : 'Visszaút'}"
                                class="fw-bold card-name"></h5>
                            <hr>
                        </div>
                        <div class="row"
                             th:each="segment : ${itinerary.getSegments()}">
                            <p class="col fs-6 text-info"
                               th:text="${segment.getDeparture().getAirportName()}"></p>
                            <p class="col fs-6"
                               th:text="${segment.getDeparture().getAt()}"></p>
                            <p class="col fs-6 text-info"
                               th:text="${segment.getArrival().getAirportName()}"></p>
                            <p class="col fs-6"
                               th:text="${segment.getArrival().getAt()}"></p>
                        </div>
                        <div class="row text-start"
                             th:if="${itinerary.getLayoverTime().size() > 0}">
                            <p class="col fs-6"
                               th:each="layover : ${itinerary.getFormattedLayoverTime()}"
                               th:text="${'Átszállási idő: ' + layover}">
                            </p>
                        </div>
                        <div class="row align-items-center"
                             th:each="segment, segmentStatus : ${itinerary.getSegments()}">
                            <hr th:if="${segmentStatus.first}">
                            <p class="col fs-6 text-info"
                               th:text="${segment.getOperating().getCarrierName()}"></p>
                            <p class="col fs-6"
                               th:if="${segment.getCarrierName() != segment.getOperating().getCarrierName()}"
                               th:text="${'Jegyértékesítő: '+segment.getCarrierName()}"></p>
                            <p class="col fs-6 text-info"
                               th:text="${segment.getAircraft().getName()}"></p>
                            <a class="col btn btn-outline-info rounded-btn"
                               th:href="'/flighttracker?flightNumber=' + ${segment.getCallSign()}"
                               th:if="${segment.isCurrentlyFlying()}">Mutasd a térképen</a>
                        </div>
                        <div class="row text-start">
                            <h5 class="fw-bold card-name">Utasok</h5>
                            <hr>
                        </div>
                        <div class="row"
                             th:each="segment, segmentStatus : ${itinerary.getSegments()}">
                            <div class="col" th:each="traveller : ${offer.getTravelerPricings()}">
                                <p class="col fs-6 fw-bold"
                                   th:text="${traveller.getTraveller()}"></p>
                                <div class="col"
                                     th:each="fareDetails : ${traveller.getFareDetailBySegmentId(segment.getId())}">
                                    <p class="col fs-6"
                                       th:text="${fareDetails.getCabin()}"></p>
                                    <p class="col fs-6"
                                       th:text="${fareDetails.getIncludedCheckedBags().getQuantity() + ' feladott poggyász'}"></p>
                                    <p class="col fs-6"
                                       th:text="${fareDetails.getIncludedCabinBags().getQuantity() + ' kézipoggyász'}"></p>
                                </div>
                                <hr th:if="${!segmentStatus.last}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>